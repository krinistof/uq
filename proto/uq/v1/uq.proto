syntax = "proto3";

package uq.v1;

// A generic event in the system.
message Event {
  // The topic identifier (Ed25519 Public Key).
  // 32 bytes.
  bytes topic_pk = 1;

  // The author's identifier (Ed25519 Public Key).
  // 32 bytes.
  bytes author_pk = 2;

  // Ed25519 Signature of the payload + topic_pk.
  // 64 bytes.
  bytes signature = 3;

  // The actual content (application specific, potentially encrypted).
  bytes payload = 4;

  // Server-assigned timestamp (Unix epoch milliseconds).
  int64 server_timestamp_ms = 5;
}

// Combined request for single connection push and pull functionality.
message SyncRequest {
  // List of events happened since last push. Can be empty.
  repeated Event events = 1;

  // User identifier to check topic whitelists for updates.
  bytes user_pk = 2;

  // Request events with server_timestamp > since_timestamp
  int64 since_timestamp_ms = 3;
}

// Response for efficient delta fetching.
message SyncResponse {
  // Events happened since requested timestamp
  repeated Event events = 1;

  // Current server timestamp (Unix epoch milliseconds)
  int64 server_timestamp_ms = 2;
}

// UniQue service for efficient and secure broadcasting.
service UqService {
  // Sync events with the server. Push and pull functionality combined.
  rpc Sync(SyncRequest) returns (SyncResponse);
}

